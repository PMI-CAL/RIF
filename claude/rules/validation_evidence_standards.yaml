# Validation Evidence Standards
# 
# Defines minimum evidence requirements for validation approval
# to prevent false positive validations like Issue #225.
#
# Issue #231: Root Cause Analysis: False Validation of MCP Server Integration

validation_evidence_standards:
  version: "1.0.0"
  effective_date: "2025-08-25"
  purpose: "Prevent false positive validations by enforcing comprehensive evidence requirements"
  
  # Global evidence requirements
  global_requirements:
    mandatory_categories:
      - "integration_testing"
      - "evidence_collection" 
      - "performance_metrics"
      - "error_handling"
      - "environment_verification"
    
    minimum_evidence_items: 10
    minimum_quality_score: 75.0
    authenticity_verification_required: true
    
  # Evidence categories and their requirements
  evidence_categories:
    
    integration_testing:
      description: "Evidence of actual system integration testing"
      category_weight: 0.35  # 35% of total validation weight
      mandatory: true
      
      required_evidence_types:
        - name: "end_to_end_connectivity_test"
          description: "Proof of actual end-to-end system connectivity"
          requirements:
            - connection_successful: true
            - protocol_compliant: true
            - actual_data_exchange_verified: true
            - response_time_measured: true
          minimum_execution_time: 1.0  # At least 1 second for real testing
          
        - name: "tool_functionality_verification"
          description: "Verification that tools actually work through the integration"
          requirements:
            - tools_tested_count: 
                minimum: 3
            - success_rate:
                minimum: 0.7  # At least 70% success rate
                maximum: 0.95  # Above 95% is suspicious
            - tool_response_times_measured: true
          
        - name: "error_condition_testing"
          description: "Testing of error conditions and edge cases"
          requirements:
            - error_scenarios_tested:
                minimum: 3
            - error_handling_verified: true
            - recovery_mechanisms_tested: true
    
    evidence_collection:
      description: "Evidence of comprehensive data collection during testing"
      category_weight: 0.20  # 20% of total validation weight
      mandatory: true
      
      required_evidence_types:
        - name: "execution_traces"
          description: "Detailed traces of test execution"
          requirements:
            - execution_start_time: "required"
            - execution_end_time: "required"
            - execution_steps_logged: true
            - command_output_captured: true
          
        - name: "system_state_monitoring"
          description: "System state before, during, and after testing"
          requirements:
            - baseline_metrics_captured: true
            - runtime_metrics_captured: true
            - final_state_captured: true
            - resource_usage_monitored: true
    
    performance_metrics:
      description: "Performance and timing measurements"
      category_weight: 0.15  # 15% of total validation weight
      mandatory: true
      
      required_evidence_types:
        - name: "timing_measurements"
          description: "Accurate timing measurements"
          requirements:
            - response_times:
                minimum: 0.01  # At least 10ms is realistic
                maximum: 30.0   # Above 30s indicates problems
            - execution_times:
                minimum: 0.1   # At least 100ms for integration tests
            - timestamp_precision: 
                maximum_decimal_places: 3  # No more than millisecond precision
          
        - name: "throughput_metrics"
          description: "System throughput under load"
          requirements:
            - requests_per_second:
                maximum: 1000  # Above 1000 RPS is suspicious for integration tests
            - concurrent_connections_tested: true
            - load_testing_performed: true
    
    error_handling:
      description: "Error handling and failure scenario testing"
      category_weight: 0.15  # 15% of total validation weight
      mandatory: true
      
      required_evidence_types:
        - name: "failure_scenario_testing"
          description: "Testing various failure scenarios"
          requirements:
            - network_failure_tested: true
            - timeout_handling_tested: true
            - invalid_input_handling_tested: true
            - resource_exhaustion_tested: false  # Optional but recommended
            
        - name: "error_documentation"
          description: "Documentation of errors encountered"
          requirements:
            - error_types_encountered:
                minimum: 1  # At least some errors expected in real testing
            - error_messages_logged: true
            - error_recovery_documented: true
    
    environment_verification:
      description: "Verification of test environment and conditions"
      category_weight: 0.15  # 15% of total validation weight
      mandatory: true
      
      required_evidence_types:
        - name: "environment_configuration"
          description: "Documentation of test environment"
          requirements:
            - system_info_captured: true
            - software_versions_documented: true
            - configuration_files_verified: true
            - dependencies_validated: true
            
        - name: "production_similarity"
          description: "Evidence that test environment resembles production"
          requirements:
            - production_config_applied: true
            - realistic_load_conditions: true
            - actual_deployment_tested: true

  # Validation quality gates
  quality_gates:
    
    evidence_completeness:
      description: "All required evidence must be present"
      threshold: 100  # 100% of required evidence must be present
      enforcement: "blocking"  # Blocks validation if not met
      
    evidence_authenticity:
      description: "Evidence must be authentic and verifiable"
      requirements:
        - timestamps_within_reasonable_range: true
        - evidence_fingerprints_valid: true
        - cross_validation_consistent: true
        - source_attribution_complete: true
      enforcement: "blocking"
      
    statistical_plausibility:
      description: "Results must be statistically plausible"
      requirements:
        - success_rates_realistic: true  # Not too perfect or too poor
        - timing_measurements_realistic: true  # Not too fast or too slow
        - resource_usage_realistic: true  # Not too low or too high
        - error_rates_realistic: true  # Some errors expected
      enforcement: "warning"  # Warns but doesn't block
      
    pattern_consistency:
      description: "Results should be consistent with historical patterns"
      requirements:
        - deviation_from_historical_patterns:
            maximum_standard_deviations: 2.0
        - execution_time_consistency: true
        - success_rate_consistency: true
      enforcement: "warning"

  # False positive detection rules
  false_positive_detection:
    
    statistical_anomaly_indicators:
      - name: "perfect_success_rate"
        description: "Success rate of 100% is suspicious"
        threshold: 0.99
        severity: "high"
        
      - name: "impossibly_fast_execution"
        description: "Execution times below minimum realistic threshold"
        threshold: 0.01  # 10ms
        severity: "critical"
        
      - name: "zero_resource_usage"
        description: "Resource usage of exactly 0 is suspicious"
        threshold: 0.001
        severity: "high"
        
      - name: "suspiciously_precise_metrics"
        description: "Metrics with excessive precision suggest fabrication"
        max_decimal_places: 3
        severity: "medium"
    
    pattern_deviation_indicators:
      - name: "historical_pattern_deviation"
        description: "Results deviate significantly from historical patterns"
        max_standard_deviations: 3.0
        severity: "medium"
        
      - name: "validation_result_repetition"
        description: "Identical results across multiple validations"
        similarity_threshold: 0.95
        severity: "high"
    
    evidence_inconsistency_indicators:
      - name: "timestamp_clustering"
        description: "All evidence has suspiciously similar timestamps"
        max_timestamp_variance: 1.0  # 1 second
        severity: "medium"
        
      - name: "missing_error_evidence"
        description: "No errors or failures in comprehensive testing"
        min_error_rate: 0.05  # Expect at least 5% failures
        severity: "low"

  # Validation workflow integration
  workflow_integration:
    
    pre_validation_checks:
      - verify_evidence_collection_session_active: true
      - validate_test_environment_setup: true
      - confirm_integration_test_execution: true
      
    during_validation_monitoring:
      - real_time_evidence_collection: true
      - statistical_anomaly_detection: true
      - pattern_deviation_monitoring: true
      
    post_validation_verification:
      - comprehensive_evidence_review: true
      - false_positive_detection_analysis: true
      - peer_validation_review_recommended: true

  # Enforcement mechanisms
  enforcement:
    
    blocking_violations:
      - insufficient_evidence_completeness: true
      - evidence_authenticity_failure: true
      - critical_statistical_anomalies: true
      - missing_mandatory_integration_tests: true
      
    warning_violations:
      - statistical_plausibility_concerns: true
      - pattern_consistency_issues: true
      - medium_severity_false_positive_indicators: true
      
    automatic_actions:
      - evidence_quality_scoring: true
      - false_positive_alert_generation: true
      - validation_history_tracking: true
      - continuous_pattern_learning: true

  # Compliance monitoring
  compliance_monitoring:
    
    metrics_tracked:
      - validation_evidence_completeness_rate: true
      - false_positive_detection_rate: true
      - validation_quality_score_distribution: true
      - enforcement_action_frequency: true
      
    reporting:
      - daily_compliance_summary: true
      - weekly_trend_analysis: true
      - monthly_effectiveness_review: true
      - quarterly_standards_review: true
      
    continuous_improvement:
      - threshold_calibration: true
      - pattern_learning: true
      - detection_algorithm_refinement: true
      - standards_evolution: true

# Configuration for specific validation types
validation_type_specific_standards:
  
  mcp_integration:
    additional_requirements:
      - claude_desktop_connectivity_verified: true
      - mcp_protocol_compliance_tested: true
      - tool_invocation_end_to_end_verified: true
      - production_configuration_tested: true
    
    enhanced_detection_rules:
      - mcp_server_startup_time:
          minimum: 0.5  # MCP server should take at least 500ms to start
      - tool_response_times:
          minimum: 0.01  # Tool calls should take at least 10ms
      - connection_establishment_time:
          minimum: 0.05  # Connection should take at least 50ms
  
  api_integration:
    additional_requirements:
      - http_request_response_cycle_verified: true
      - authentication_flow_tested: true
      - error_status_codes_handled: true
      - rate_limiting_tested: true
      
  database_integration:
    additional_requirements:
      - connection_pool_management_tested: true
      - transaction_rollback_tested: true
      - query_performance_measured: true
      - data_consistency_verified: true

# Emergency overrides (for exceptional circumstances)
emergency_overrides:
  description: "Emergency procedures for critical situations"
  
  conditions_for_override:
    - critical_production_issue: true
    - security_vulnerability_fix: true
    - regulatory_compliance_requirement: true
    
  override_requirements:
    - senior_approval_required: true
    - detailed_justification_documented: true
    - compensating_controls_implemented: true
    - follow_up_full_validation_scheduled: true
    
  override_limitations:
    - maximum_duration: "24_hours"
    - maximum_frequency: "once_per_month"
    - audit_trail_mandatory: true

# Version history and change management
version_history:
  - version: "1.0.0"
    date: "2025-08-25"
    changes: "Initial version implementing Issue #231 requirements"
    author: "RIF-Implementer"
    rationale: "Prevent false positive validations like Issue #225"