{
  "version": "2.0",
  "description": "Enhanced branch protection configuration for GitHub-First Automation System (Issue #283)",
  "repository": "current",
  "protection_rules": {
    "main": {
      "require_pr": true,
      "require_reviews": 0,
      "dismiss_stale_reviews": true,
      "require_status_checks": [
        "complexity_assessment",
        "github_automation (test)",
        "github_automation (lint)",
        "github_automation (security)",
        "github_automation (coverage)",
        "summary_report"
      ],
      "require_up_to_date": true,
      "allow_auto_merge": true,
      "delete_branch_on_merge": true,
      "restrict_pushes": true,
      "allow_force_pushes": false,
      "allow_deletions": false,
      "require_merge_queue": true,
      "merge_method": "squash"
    }
  },
  "branches": {
    "main": {
      "protection": {
        "required_status_checks": {
          "strict": true,
          "contexts": [
            "complexity_assessment",
            "github_automation (test)",
            "github_automation (lint)",
            "github_automation (security)",
            "github_automation (coverage)",
            "summary_report"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 0,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": false,
          "dismissal_restrictions": {},
          "bypass_pull_request_allowances": {}
        },
        "restrictions": null,
        "required_linear_history": false,
        "allow_force_pushes": false,
        "allow_deletions": false,
        "block_creations": false,
        "required_conversation_resolution": true,
        "lock_branch": false,
        "allow_fork_syncing": true
      },
      "merge_queue": {
        "enabled": true,
        "merge_method": "squash",
        "max_entries_to_build": 5,
        "min_entries_to_merge": 1,
        "wait_timer": 0,
        "required_status_checks": ["complexity_assessment", "github_automation"]
      },
      "progressive_automation": {
        "enabled": true,
        "levels": [
          {
            "name": "github_only",
            "description": "Trivial changes (dependency updates, docs)",
            "criteria": {
              "max_lines_changed": 10,
              "is_dependency_update": true,
              "files_changed": 1
            },
            "required_checks": ["complexity_assessment"],
            "auto_merge_enabled": true,
            "review_required": false
          },
          {
            "name": "copilot_assisted",
            "description": "Simple changes with high test coverage",
            "criteria": {
              "max_lines_changed": 50,
              "max_files_changed": 5,
              "no_architecture_changes": true,
              "test_coverage_min": 80
            },
            "required_checks": [
              "complexity_assessment",
              "github_automation (test)",
              "github_automation (lint)"
            ],
            "auto_merge_enabled": true,
            "review_required": false
          },
          {
            "name": "rif_integration",
            "description": "Complex changes requiring RIF agent intervention",
            "criteria": {
              "min_lines_changed": 50,
              "has_architecture_changes": true,
              "new_features": true
            },
            "required_checks": [
              "complexity_assessment",
              "github_automation (test)",
              "github_automation (lint)",
              "github_automation (security)",
              "github_automation (coverage)",
              "summary_report"
            ],
            "auto_merge_enabled": false,
            "review_required": true,
            "rif_trigger_required": true
          }
        ]
      }
    }
  },
  "automation_integration": {
    "intelligent_pr_workflow": {
      "enabled": true,
      "workflow_file": ".github/workflows/intelligent-pr-automation.yml",
      "auto_fix_enabled": true,
      "auto_fix_scripts": [
        "scripts/auto-fix-lint.sh",
        "scripts/auto-fix-format.sh",
        "scripts/auto-fix-simple-issues.sh"
      ],
      "rif_integration": {
        "trigger_file_pattern": "rif-trigger-*.json",
        "claude_hooks_file": ".claude/settings.json",
        "complexity_thresholds": {
          "trivial": {
            "max_lines": 10,
            "max_files": 1,
            "dependency_update_only": true
          },
          "simple": {
            "max_lines": 50,
            "max_files": 5,
            "no_architecture_changes": true
          },
          "medium": {
            "max_lines": 200,
            "max_files": 10,
            "limited_architecture_changes": true
          },
          "complex": {
            "min_lines": 200,
            "significant_changes": true,
            "architecture_changes": true
          }
        }
      }
    }
  },
  "quality_gates": {
    "test_coverage": {
      "enabled": true,
      "minimum_percentage": 80,
      "fail_below": 70,
      "enforce_for_automation_levels": ["copilot_assisted", "rif_integration"]
    },
    "security_scanning": {
      "enabled": true,
      "block_on_critical": true,
      "block_on_high": false,
      "auto_fix_enabled": true
    },
    "performance_impact": {
      "enabled": true,
      "max_regression_percent": 10,
      "baseline_comparison": true
    },
    "code_quality": {
      "enabled": true,
      "lint_must_pass": true,
      "format_must_pass": true,
      "auto_fix_attempts": 3
    }
  },
  "emergency_procedures": {
    "override_enabled": true,
    "override_roles": ["admin", "owner"],
    "override_audit_log": ".github/branch-protection-emergency-log.json",
    "rollback_script": "scripts/rollback_branch_protection.py",
    "emergency_contacts": ["PMI-CAL"],
    "override_reasons": [
      "critical_security_patch",
      "emergency_hotfix",
      "system_outage_recovery",
      "deployment_blocker",
      "automation_system_failure"
    ],
    "automation_bypass": {
      "enabled": true,
      "fallback_to_rif_agents": true,
      "github_actions_failure_threshold": 3
    }
  },
  "monitoring": {
    "audit_enabled": true,
    "audit_log_path": ".github/branch-protection-audit.json",
    "metrics_collection": true,
    "automation_metrics": {
      "track_automation_level_usage": true,
      "track_auto_fix_success_rate": true,
      "track_merge_time_reduction": true,
      "track_rif_trigger_frequency": true
    },
    "alerts": {
      "protection_disabled": true,
      "emergency_override_used": true,
      "repeated_failures": true,
      "automation_failure_pattern": true,
      "auto_fix_failure_rate_high": true
    },
    "dashboards": {
      "pr_processing_metrics": true,
      "automation_effectiveness": true,
      "quality_gate_performance": true
    }
  },
  "rollback_strategy": {
    "enabled": true,
    "automatic_rollback": {
      "enabled": true,
      "triggers": [
        "quality_gate_failure_rate_above_50_percent",
        "auto_merge_errors_above_10_percent",
        "security_incident_detected"
      ],
      "rollback_to": "previous_configuration",
      "notification_channels": ["github_issues", "emergency_contacts"]
    },
    "manual_rollback": {
      "command": "scripts/rollback_automation_system.sh",
      "restore_previous_workflows": true,
      "preserve_audit_logs": true
    }
  },
  "integration_points": {
    "claude_code_hooks": {
      "session_start_detection": true,
      "rif_trigger_detection": true,
      "context_integration": true
    },
    "github_copilot": {
      "review_integration": "planned",
      "auto_fix_suggestions": "planned"
    },
    "existing_workflows": {
      "rif_pr_automation": "enhanced",
      "rif_pr_quality_gates": "integrated",
      "emergency_hotfix": "preserved"
    }
  },
  "success_metrics": {
    "target_pr_processing_time_reduction": "50%",
    "target_automation_coverage": "85%",
    "target_manual_intervention_reduction": "60%",
    "target_quality_gate_pass_rate": "95%",
    "baseline_measurement_period": "30_days",
    "reporting_frequency": "weekly"
  },
  "metadata": {
    "created": "2025-08-27T07:45:00Z",
    "created_by": "RIF-Implementer",
    "issue": "283",
    "phase": "1",
    "description": "Enhanced branch protection for GitHub-First Automation System",
    "last_updated": "2025-08-27T07:45:00Z",
    "version_history": [
      {
        "version": "2.0",
        "date": "2025-08-27T07:45:00Z",
        "changes": "Enhanced configuration for intelligent PR automation with progressive automation levels",
        "agent": "RIF-Implementer",
        "issue": "283"
      }
    ],
    "compatibility": {
      "github_enterprise": true,
      "github_free": true,
      "required_permissions": ["admin", "write", "actions"]
    }
  }
}
