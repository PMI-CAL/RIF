{
  "name": "RIF - Reactive Intelligence Framework",
  "version": "2.0.0",
  "description": "Automatic intelligent development system with GitHub orchestration",
  
  "hooks": {
    "SessionStart": [
      {
        "type": "command",
        "command": "echo '=== RIF Session Started ===' && gh issue list --state open --label 'state:*' --json number,title,labels,body 2>/dev/null | jq -r '.[:5] | .[] | \"Issue #\\(.number): \\(.title) [\\([.labels[].name] | join(\", \"))]\"' || echo 'No active RIF issues found'",
        "output": "context"
      },
      {
        "type": "command",
        "command": "if [ -f ./knowledge/patterns/recent.json ]; then echo 'Loading recent patterns...'; jq -r '.patterns[:3] | .[] | \"Pattern: \\(.name) - \\(.description)\"' ./knowledge/patterns/recent.json 2>/dev/null || true; fi",
        "output": "context"
      }
    ],
    
    "UserPromptSubmit": [
      {
        "type": "command",
        "command": "python3 knowledge/conversations/capture_user_prompt.py",
        "output": "silent"
      },
      {
        "matcher": ".*issue.*|.*fix.*|.*implement.*|.*analyze.*|.*create.*|.*build.*",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'RIF: Checking for similar past issues...' && if [ -f ./knowledge/issues/resolved.json ]; then jq -r '.issues[] | select(.similarity > 0.7) | \"Similar: \\(.title) - Solution: \\(.solution)\"' ./knowledge/issues/resolved.json 2>/dev/null | head -3 || true; fi",
            "output": "context"
          }
        ]
      },
      {
        "matcher": ".*test.*|.*validate.*|.*check.*|.*quality.*|.*threshold.*",
        "hooks": [
          {
            "type": "command",
            "command": "echo 'RIF: Loading quality gates...' && if [ -f ./knowledge/metrics/quality.json ]; then jq -r '.gates | to_entries[] | \"\\(.key): \\(.value.threshold) (current: \\(.value.current))\"' ./knowledge/metrics/quality.json 2>/dev/null || true; fi",
            "output": "context"
          },
          {
            "type": "command",
            "command": "echo 'RIF: Context-aware thresholds active' && if [ -f ./config/component-types.yaml ]; then echo 'Component types: critical_algorithms(95%), public_apis(90%), business_logic(85%), integration_code(80%), ui_components(70%), test_utilities(60%)' | head -1; fi",
            "output": "context",
            "description": "Show active adaptive threshold configuration"
          }
        ]
      }
    ],
    
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$1\" == *\"npm test\"* ]] || [[ \"$1\" == *\"pytest\"* ]]; then echo 'RIF: Creating checkpoint before test run...'; mkdir -p ./knowledge/checkpoints && date -u +\"%Y-%m-%dT%H:%M:%SZ\" > ./knowledge/checkpoints/latest.txt; fi",
            "output": "silent"
          }
        ]
      }
    ],
    
    "PostToolUse": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 knowledge/conversations/capture_tool_use.py",
            "output": "silent",
            "description": "Capture all tool usage for conversation analysis"
          }
        ]
      },
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "echo '{\"timestamp\": \"'$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")'\", \"action\": \"code_modified\", \"files\": \"'$1'\"}' >> ./knowledge/events.jsonl",
            "output": "silent"
          },
          {
            "type": "command",
            "command": "echo 'RIF: Code modified, updating dependency graph...' && echo '{\"file\": \"'$1'\", \"timestamp\": \"'$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")'\"}' >> ./knowledge/dependencies.jsonl",
            "output": "silent"
          },
          {
            "type": "command",
            "command": "echo 'RIF: Analyzing file for adaptive thresholds...' && python3 ./claude/commands/quality_gates/component_classifier.py classify \"$1\" 2>/dev/null | jq -r 'if .component_type then \"File \\(.file_path): \\(.component_type) (\\(.confidence*100|floor)% confidence)\" else empty end' || true",
            "output": "context",
            "description": "Context-aware quality threshold analysis for modified files"
          },
          {
            "type": "command",
            "command": "echo 'RIF: Checking for shadow issue triggers...' && python3 systems/shadow_issue_monitor.py scan >/dev/null 2>&1 && echo 'Shadow issue check complete' || echo 'Shadow monitoring failed' >> ./knowledge/errors/logs/shadow-monitor-failures.log",
            "output": "silent",
            "description": "Trigger shadow issue creation for critical changes"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "if [[ \"$1\" == *\"git commit\"* ]]; then echo 'RIF: Commit detected, updating knowledge base...'; echo '{\"action\": \"commit\", \"timestamp\": \"'$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")'\"}' >> ./knowledge/events.jsonl; fi",
            "output": "silent"
          },
          {
            "type": "command",
            "command": "BASH_EXIT_CODE=$CLAUDE_TOOL_EXIT_CODE; BASH_STDERR=\"$CLAUDE_TOOL_STDERR\"; if [ $BASH_EXIT_CODE -ne 0 ]; then python3 ./claude/commands/session_error_handler.py --capture-bash \"$1\" $BASH_EXIT_CODE \"$BASH_STDERR\" 2>/dev/null || echo 'RIF: Session error handler failed' >> ./knowledge/errors/logs/handler-failures.log; fi",
            "output": "silent"
          }
        ]
      },
      {
        "matcher": "Read|Glob|Grep|LS",
        "hooks": [
          {
            "type": "command", 
            "command": "if [ ! -z \"$CLAUDE_TOOL_ERROR\" ]; then python3 ./claude/commands/session_error_handler.py --capture-tool \"$CLAUDE_TOOL_NAME\" \"$CLAUDE_TOOL_ERROR\" 2>/dev/null || true; fi",
            "output": "silent"
          }
        ]
      }
    ],
    
    "AssistantResponseGenerated": [
      {
        "type": "command",
        "command": "python3 knowledge/conversations/capture_assistant_response.py",
        "output": "silent",
        "description": "Capture assistant responses for conversation analysis"
      }
    ],
    
    "ErrorCapture": [
      {
        "type": "command",
        "command": "python3 ./claude/commands/session_error_handler.py --capture-generic \"$CLAUDE_ERROR_MESSAGE\" --context '{\"source\": \"claude_code\", \"error_context\": \"$CLAUDE_ERROR_CONTEXT\", \"stack_trace\": \"$CLAUDE_ERROR_STACK\"}' 2>/dev/null || echo 'RIF: Critical error in session error handler' >> ./knowledge/errors/logs/system-failures.log",
        "output": "context"
      }
    ],
    
    "Stop": [
      {
        "type": "command",
        "command": "echo 'RIF: Session complete. Updating metrics...' && if [ -f ./knowledge/events.jsonl ]; then wc -l ./knowledge/events.jsonl | awk '{print \"Events recorded: \" $1}'; fi",
        "output": "context"
      },
      {
        "type": "command",
        "command": "python3 ./claude/commands/session_error_handler.py --session-summary 2>/dev/null && echo 'RIF: Session error summary generated'",
        "output": "context"
      }
    ],
    
    "SubagentStop": [
      {
        "type": "command",
        "command": "echo 'RIF: Agent task complete' && echo '{\"agent\": \"subagent\", \"completed\": \"'$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")'\"}' >> ./knowledge/events.jsonl",
        "output": "silent"
      }
    ]
  },
  
  "automations": {
    "issue_detection": {
      "enabled": true,
      "interval": "5m",
      "command": "gh issue list --state open --label 'state:new' --json number --jq '.[0].number' 2>/dev/null",
      "trigger": "rif-analyst"
    },
    
    "knowledge_update": {
      "enabled": true,
      "interval": "30m",
      "command": "find ./knowledge -name '*.jsonl' -mmin -30 | wc -l",
      "threshold": 10,
      "action": "consolidate"
    },
    
    "checkpoint_cleanup": {
      "enabled": true,
      "interval": "daily",
      "retention": "7d",
      "path": "./knowledge/checkpoints"
    }
  },
  
  "agents": {
    "rif-analyst": {
      "trigger": ["state:new", "state:analyzing"],
      "parallel": true,
      "tasks": 4
    },
    "rif-planner": {
      "trigger": ["state:planning"],
      "parallel": true,
      "tasks": 4
    },
    "rif-architect": {
      "trigger": ["state:architecting"],
      "parallel": true,
      "tasks": 4
    },
    "rif-implementer": {
      "trigger": ["state:implementing"],
      "parallel": true,
      "tasks": 4
    },
    "rif-validator": {
      "trigger": ["state:validating"],
      "parallel": true,
      "tasks": 4
    },
    "rif-learner": {
      "trigger": ["state:learning", "state:complete"],
      "parallel": false,
      "tasks": 1
    },
    "rif-projectgen": {
      "trigger": ["/newproject"],
      "parallel": false,
      "tasks": 1,
      "interactive": true
    }
  },
  
  "commands": {
    "/newproject": {
      "script": "$RIF_HOME/scripts/newproject.sh",
      "description": "Create new RIF-enabled project with intelligent discovery",
      "interactive": true,
      "agent": "rif-projectgen"
    }
  }
}